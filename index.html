<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your fav video</title>
    <link rel="stylesheet" href="index.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #video-container {
            display: none;
        }

        #play-video {
            position: relative;
            width: 50px;
            height: 50px;
        }

        #exit-video {
            position: relative;
            width: 50px;
            height: 50px;
        }

        video {
            width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
    <center>
        <div id="survey-container">
            <article id="general-survey">
                <h2>Survey</h2>

                <form>
                    <!-- put form stuff here -->
                </form>

                <button id="general-survey-continue">Continue</button>
            </article>

            <article id="video-screen">
                <p>Watch the video (Once only, and preferably in full screen)</p>
                <button id="watch-video">Watch Video</button>
            </article>

            <article id="video-survey">
                <p>Survey</p>

                <form>
                    codes for form 
                </form>

                <button id="submit-survey">Submit</button>
                <h4>Thanks for participating!</h4>
            </article>
        </div>
        <div id="video-container">
            <video id="video" style="pointer-events: none;" src=""></video>
            <button id="play-video">Play Video</button>
            <button id="exit-video">Continue</button>
        </div>
    </center>


    <script>
        // change these links later
        // test with shorter video first
        const videoURLList = [
            'vid.mp4'
            //'https://survey-webserver-reza.s3.amazonaws.com/QS/GTA_QS.mp4',
        ];

        const screenGeneralSurvey = document.getElementById("general-survey");
        const continueButton = document.getElementById("general-survey-continue");
        const screenVideo = document.getElementById("video-screen");
        const screenVideoSurvey = document.getElementById("video-survey");
        const submitButton = document.getElementById("submit-survey");

        const surveyContainer = document.getElementById("survey-container");
        const videoContainer = document.getElementById("video-container");

        const video = document.getElementById("video");
        const watchVideoButton = document.getElementById("watch-video");
        const playButton = document.getElementById("play-video");
        const exitVideoButton = document.getElementById("exit-video");

        function hide(el) {
            el.style.display = 'none';
        }
        function show(el) {
            el.style.display = 'unset';
        }

        function videoMain() {
            async function downloadVideo(url) {
                const response = await fetch(url);
                return response.blob();
            }
            // load all the videos in the background
            const blobs = [];
            for (const url of videoURLList) {
                blobs.push(downloadVideo(url));
            }

            function moveOnTopOfVideo(el) {
                const y = (video.offsetHeight + el.offsetHeight) / 2;
                console.log(y);
                el.style.bottom = `${y}px`;
            }

            function displayVideo(index) {
                hide(exitVideoButton);
                show(playButton);
                moveOnTopOfVideo(playButton);
                blobs[index]?.then(blob => {
                    video.src = URL.createObjectURL(blob);
                });
            }
            // display the first video
            displayVideo(0);

            video.addEventListener('pause', function () {
                show(exitVideoButton);
                moveOnTopOfVideo(exitVideoButton);
            });

            playButton.addEventListener('click', function () {
                hide(playButton);
                if (document.fullscreen === true) {
                    video.play();
                } else {
                    console.log("video must be fullscreen to play");
                }
            });
        }

        hide(screenVideo);
        hide(screenVideoSurvey);
        hide(videoContainer);

        continueButton.addEventListener('click', function () {
            hide(screenGeneralSurvey);
            show(screenVideo);
        });

        watchVideoButton.addEventListener('click', function () {
            document.body.requestFullscreen()
                .then(function () {
                    hide(surveyContainer);
                    show(videoContainer);
                    videoMain();
                })
                .catch(function (error) {
                    console.log('problem starting fullscreen', error);
                });
        });

        exitVideoButton.addEventListener('click', function () {
            document.exitFullscreen()
                .then(function () {
                    hide(screenVideo);
                    hide(videoContainer);
                    show(surveyContainer);
                    show(screenVideoSurvey);
                })
                .catch(function (error) {
                    console.log('problem exiting fullscreen', error);
                });
        });

        submitButton.addEventListener('click', function () {
        });
    </script>
</body>

</html>
